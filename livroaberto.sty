% ************************************************************
\def\fileversion{v1.0}
\def\filename{livroaberto}
\def\filetitle{Livro Aberto package}
\def\filedate{2018/02/13}
\def\docdate {2018/02/13}
\def\fontspath{Fontes/}
\def\graphics{Figuras/}

\def\aluno{1}

% Package insert
% ***********************************************************
\RequirePackage[skins,breakable]{tcolorbox} %  tocolorbo 盒子
\RequirePackage{varwidth}
\RequirePackage{array} 
\RequirePackage{colortbl}
\RequirePackage{bookmark} % This package implements a new bookmark (outline) organization for
% package hyperref. Bookmark properties such as style and color can now
% be set. Other action types are available (URI, GoToR, Named). The book-
% marks are generated in the first compile run. Package hyperref uses two
% runs.
\RequirePackage[math]{cellspace} % This package is intended to allow automatic spacing out of the lines of an array.
\RequirePackage{float}
\RequirePackage{tkz-euclide}
\RequirePackage{amsmath,amssymb}
\RequirePackage[brazil]{babel}
\RequirePackage{times}
\RequirePackage{tabulary}
\RequirePackage{geometry}
\RequirePackage{hypcap}
\RequirePackage{makeidx}
\makeindex
\RequirePackage{xurl}
\RequirePackage{amsmath,amssymb,amsfonts,amsthm,amstext}
\RequirePackage{tabu} 
\RequirePackage{hhline}
\RequirePackage{pbox}
\RequirePackage{ragged2e}
\RequirePackage{microtype}
\RequirePackage{tabularx}
\RequirePackage{makecell}
\RequirePackage{longtable}
\RequirePackage{wrapfig}
\RequirePackage{bm}
\RequirePackage[low-sup]{subdepth} 
\RequirePackage{tikz-3dplot}
\RequirePackage{pgfplots}
\RequirePackage[inline, attach]{asymptote} % the Vector Graphics Language
\RequirePackage[dvips]{attachfile2}
\RequirePackage{vwcol}
\RequirePackage{tikz}
\RequirePackage{ifthen}
\RequirePackage[export]{adjustbox}
\RequirePackage{xparse} % For RenewDocumentEnvironment
\RequirePackage{expl3} % macro programming projects 
\RequirePackage{tcolorbox} %Allow those nice environments
\tcbuselibrary{theorems, listings, breakable, most, skins}
\RequirePackage{titling} % needed to manage with the title
\RequirePackage{eso-pic}% to the cover style
\usetikzlibrary{patterns,intersections, positioning, fit, backgrounds, shapes, fadings,
decorations.pathmorphing, graphs, quotes, angles, calc, through, backgrounds}
\RequirePackage{comment}
\RequirePackage{ltxcmds}
\RequirePackage{amstext}



\RequirePackage{textcomp}% "warn" option issued from template
% \RequirePackage[explicit]{titlesec}
\PassOptionsToPackage{explicit}{titlesec}
\RequirePackage{zref-savepos} % This package replaces \includeonly by an interactive user interface
\RequirePackage{longtable}
\RequirePackage{makeidx}
\RequirePackage{fancyvrb}
\RequirePackage{wrapfig}
\RequirePackage{parskip}[=v1]
\RequirePackage{parskip}
\RequirePackage{alltt}
\RequirePackage{upquote}
\RequirePackage{capt-of}
\RequirePackage{needspace}
\RequirePackage{mathtools}
\ltx@ifundefined{@removefromreset}
{\RequirePackage{remreset}}
\RequirePackage{atbegshi}
\RequirePackage{kvoptions}
\RequirePackage{sphinx}
\@ifclassloaded{memoir}{}{\RequirePackage{fancyhdr}}
\RequirePackage{etoolbox}
\RequirePackage{framed}
\RequirePackage{siunitx}
\RequirePackage{caption}
\RequirePackage{pdfpages}
\RequirePackage{layout}
\RequirePackage{stackengine}
\RequirePackage{changepage}
\RequirePackage{graphicx}
\RequirePackage{adjustbox}
% \RequirePackage{scrlayer-notecolumn}
\RequirePackage{marginfix}
\RequirePackage{pdfpages}
\RequirePackage{stmaryrd}
\RequirePackage{lscape}

\RequirePackage[sectionbib]{natbib}
\RequirePackage{chapterbib}
\patchcmd{\thebibliography}{
  \defcor2{cor1}
  \phantomsection
  \chapter*{\textcolor{cor1}{\bibname}}\@mkboth{\MakeUppercase\bibname}{\MakeUppercase\bibname}}{
  \bibliographytitle*{Bibliografia}}{}{}

\RequirePackage{spverbatim}
% \RequirePackage{ulem}
\RequirePackage{cancel}
\RequirePackage{ifthen}
\RequirePackage{booktabs}
\RequirePackage{listofitems}
\RequirePackage{url}
\RequirePackage{graphicx}
%\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{forloop}
\RequirePackage{lipsum}
\RequirePackage{suffix}
\RequirePackage{refcount}
% \RequirePackage[hidelinks]{hypreref}
\RequirePackage{xcolor}
\RequirePackage{multicol}
\RequirePackage{etex}
\RequirePackage{multirow}
%\RequirePackage[brazilian]{babel}
\RequirePackage{blindtext}

\RequirePackage{cleveref}
\RequirePackage{collcell} % This package provides macros which collect the cell content of a tabular and provide it to a macro as argument. 
\RequirePackage{datatool}
\RequirePackage{environ}
\RequirePackage{xstring}

\RequirePackage{hyperref}
\PassOptionsToPackage{bookmarks=false}{hyperref}
\hypersetup{colorlinks=true, colorlinks=true, linkcolor=linkscolor, filecolor=linkscolor, urlcolor=linkscolor,citecolor=linkscolor}

\tcbuselibrary{skins,breakable}
\RequirePackage{graphicx}
\@ifclassloaded{memoir}{}{\RequirePackage{fancyhdr}}

% MathOperator definition 
% ************************************************
\DeclareMathOperator{\sen}{sen}
\DeclareMathOperator{\tg}{tg}
\DeclareMathOperator{\cotg}{cotg}
\DeclareMathOperator{\cosec}{cosec}
\DeclareMathOperator{\arcsen}{arcsen}
\DeclareMathOperator{\arctg}{arctg}
\DeclareMathOperator{\senh}{senh}
\DeclareMathOperator{\tgh}{tgh}
\DeclareMathOperator{\mdc}{mdc}
\DeclareMathOperator{\mmc}{mmc}
\DeclareMathOperator{\rad}{rad}
\DeclareMathOperator{\dirac}{\delta}
\DeclareMathOperator{\mmu}{\mu}
\renewcommand{\Im}{\operatorname{Im}}
\DeclareMathOperator{\D}{D}
\DeclareMathOperator{\CD}{CD}
\DeclareMathOperator{\area}{\text{Area}\,}

\newcommand{\R}{\mathbb{R}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}

\definecolor{shang}{RGB}{82,53,85}
\definecolor{shang1}{RGB}{162,89,131}
\definecolor{shang2}{RGB}{125,86,121}
\definecolor{huang}{RGB}{255,219,145}

% Renewcommands
% ************************************************
\renewcommand{\bottomtitlespace}{0.25\textheight}
%\pgfplotsset{compat=1.16}
\renewcommand{\thead}{\rowfont{\bfseries \color{white}} \rowcolor{cor2!80}}
\newcommand{\tnumber}{\rowfont{\color{white}}\rowcolor{cor2!80}}
\newcommand{\tmat}[1]{\cellcolor{cor2!80}\textcolor{white}{\bm{#1}}}
\newcommand{\tcolor}[1]{\cellcolor{cor2!80}\textcolor{white}{\textbf{#1}}}
\newcommand{\tmcol}[3]{\multicolumn{#1}{#2}{\cellcolor{cor2!80}\textcolor{white}{\textbf{#3}}}}
\newcommand{\titem}[1]{\textcolor{cor2}{\textbf{#1}}}
\newcommand{\tikzcolor}{cor2!80}
\newcommand{\sub}{\textsubscript}
\newcommand{\super}{\textsuperscript}
\newcommand{\newparallel}{\mathrel{\mkern-5mu\clipbox{0 0.75ex 0 0}{${\sslash}$}\!}}
\renewcommand{\mspace}[1]{}

% Newcommand definition
% ************************************************
\def\fle{\longrightarrow}
\def\entao{\Longrightarrow}
\def\ssi{\Longleftrightarrow}
\def\ri{\rightarrow}
\def\bbullet{\noindent{\cor $\bullet$ }}
\newcommand{\no}{\noindent}
\newcommand{\fra}[2]{\text{\small$\dfrac{#1}{#2}$}}
\newcommand{\ve}[1]{{\overrightarrow{#1\,\,}}}
\newcommand{\ol}[1]{{\overline{#1}}}
\newcommand{\interno}[2]{{\langle{#1},{#2}\rangle}}

\newcolumntype{d}[1]{>{\vspace{2.5pt}}m{#1}<{\vspace{2.5pt}}}
\newcolumntype{e}[1]{>{\vspace{2.5pt}\centering}m{#1}<{\vspace{2.5pt}}}
\newcolumntype{f}{>$c<$}

% Prevent a clash with tabu, or other packages that also define \extrarowdepth.
% ************************************************
\AtBeginDocument{%
  \ifdefdimen\extrarowdepth{} % \extrarowdepth already defined as a length
  {\ifdef\extrarowdepth % if it is defined but not a length, we have an error
    {\PackageError{extrarowdepth}{Cannot define length \string\extrarowdepth}
      {There is already a \string\extrarowdepth\space and it is not a length parameter.}}
    {\newlength\extrarowdepth\setlength\extrarowdepth{0pt}}}
  \newlength\@temprowdepth}

\RequirePackage{array}
\RequirePackage{etoolbox}

\patchcmd{\@array}{\setbox \@arstrutbox \hbox{\vrule \@height \arraystretch \@tempdima \@depth \arraystretch \dp \strutbox \@width \z@}}
{\@temprowdepth  \dp \strutbox \advance \@temprowdepth by\extrarowdepth \setbox \@arstrutbox \hbox{\vrule \@height \arraystretch \@tempdima \@depth \arraystretch \@temprowdepth \@width \z@}}
{\PackageInfo{extrarowdepth}{\string\extrarowdepth\space added to the array package}}
{\PackageWarning{extrarowdepth}{Failed to include \string\extrarowdepth\space in the array package}}
\let\@@array\@array

\newcommand\tablinesep[1]{
	\setlength{\extrarowheigth}{#1}
	\setlength{\extrarowdepth}{#1}
}
% Place enumerate lists in the standard of the exercise section
% *****************************************************
\newcommand\exerciselist
{	
	\setlist[enumerate]{label=\protect\enumbox{\arabic*}}
	\setlist[enumerate,2]{label=\textit{\alph*)}}
	\setlist[enumerate,3]{label=\textit{\roman*)}}
}

\newcommand\semihuge{\@setfontsize\semiHuge{16.72}{21.38}}

\renewcommand{\fref}[1]{\hyperref[#1]{figura \ref{#1}}}
\newcommand{\Fref}[1]{\hyperref[#1]{Figura \ref{#1}}}

\renewcommand{\tref}[1]{\hyperref[#1]{tabela \ref{#1}}}
\newcommand{\Tref}[1]{\hyperref[#1]{Tabela \ref{#1}}}

% 代码块注释环境
% *******************************************************
\usepackage{tcolorbox}
\tcbuselibrary{listings}
\lstdefinestyle{mystyle}{
  basicstyle=%
    \ttfamily
    \lst@ifdisplaystyle\small\fi
}

\lstset{basicstyle=\ttfamily,style=mystyle}

\definecolor{structurecolor}{RGB}{0,120,2}%
\definecolor{winered}{rgb}{0.5,0,0}
\definecolor{lightgrey}{rgb}{0.9,0.9,0.9}
\definecolor{frenchplum}{RGB}{190,20,83}
\lstset{language=[LaTeX]TeX,
	texcsstyle=*\color{magenta},
    numbers=none, 
    %numberstyle=\tiny\color{blue}, 
    stepnumber=1, 
    numbersep=5pt, 
    breaklines=true,
    basicstyle=\scriptsize\ttfamily\color{session1},
	keywordstyle=\color{magenta},
    commentstyle=\color{gray},
    morestring=[s][\bfseries\color{blue!40}]{\[}{\]},
    morestring=[s][\bfseries\color{cyan}]{\{}{\}},
    %morestring=[s][\bfseries\color{violet}]{(}{)},
	emph={main,none,fontenc,fontspec,xeCJK,FiraMono,xunicode,newtxmath,figure,fig,image,img,table,itemize,enumerate,newtxtext,newtxtt,ctex,microtype,description,times,newtx,booktabs,tabular,PDFLaTeX,XeLaTeX,type1cm,BibTeX,device,color,mode,lang,amsthm,tcolorbox,titlestyle,cite,marginnote,ctex,listings},
	emphstyle={\color{yellow!20!red}},
	morekeywords={main,pic,DeclareSymbolFont,SetSymbolFont,toprule,midruletikzstyle,bottomrule,institute,version,includegraphics,setmainfont,setsansfont,setmonofont ,setCJKmainfont,setCJKsansfont,setCJKmonofont,RequirePackage,figref,tabref,email,maketitle,keywords,definecolor,extrainfo,logo,cover,subtitle,appendix,chapter,hypersetup,mainmatter,tableofcontents,elegantpar,numbers,authoryear,heiti,kaishu,lstset,pagecolor,zhnumber,marginpar,part,equote},
    frame=shadowbox,
    rulesepcolor=\color{blue!15!white},
    tabsize=2,
	rulecolor=\color{blue!30},
	framerule=0.5pt,
	columns=flexible,
	%backgroundcolor=\color{lightgrey}
}


% 1 - Open Book Boxes
%*******************************************************
% This package creates and typesets the text boxes for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems

% Loads the ifthen package
% *******************************************************
\RequirePackage{ifthen}
\RequirePackage{mfirstuc} %To capitalize just the inicial letter of each word. There is a command to exclude specific words to captalize such like a, an, the, etc.
\RequirePackage{anyfontsize} %To define fontsize precisely

\tikzstyle{outlinebox} = [fill=box2]
\tikzstyle{box} = [inner sep=3mm, inner ysep=3mm]

% Define the vertical skip for the environments
\newskip\libroskip
\libroskip= 4pt plus 1pt minus 1pt
\hfuzz=4pt
\graphicspath{\graphics}

\def\envskip{\vskip\libroskip}

\newtcolorbox[auto counter, number within=chapter, number freestyle={\noexpand\arabic{\tcbcounter}}]{task}[1]{parbox=false, blanker, enhanced, breakable, before skip = 8mm, after skip = 5mm, left=0.3mm, right=0.8mm, top=5mm, bottom=3mm, colback=white, colframe=cor2!70, width=162mm, 
borderline west={3mm}{0pt}{white}, 
  toprule=0pt,
  bottomrule=0.5pt,
  rightrule=-1pt,
  leftrule=-1pt,
  outer arc = 3mm,
  arc = 3mm,
  sharp corners = northeast,
  sharp corners = southeast,
  sharp corners = southwest,
  fontupper=\fontsize{11}{15.5}\boxexample, % Should be 11 pt.
fonttitle=\boxtitlefont\large,  % Should be 9 pt. Don't know how to set this. Tried \fontsize{9pt}{}, but didn't work.
coltitle=cor2,
title=\color{session1}\makefirstuc{#1\hfill}, 
boxed title style={empty,arc=1pt,outer arc=1pt,boxrule=1pt}, 
attach boxed title to top left={xshift=-1 mm , yshift=-0.1mm},
underlay boxed title ={
% Draw the small arc on the top left.
\draw[box1, line width = 1pt] ($(title.south west)+(3mm,0mm)$) coordinate (LU) arc [start angle=90, end angle=180, y radius=2mm, x radius=2mm] --++ (0mm , -2mm);
% Draw the top line from the left to the right.
\draw[box1,  line width=1pt] (LU) -- ++ (158mm,0mm) coordinate (R);
% Think on the Atividade box as an ABCD rectangle (clockwise, A is top left), now you see the coordinates. 
\fill [box1] ($(R)+(0mm,-.3mm)$) -- ++ (-25.00mm,0mm) coordinate (D) --++ (0mm, 5mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++ (25.00mm,0mm) coordinate (B) --++ (0.00mm,-5mm)  arc [start angle=0, end angle=-90, y radius=2.00mm, x radius=2.00mm] -- cycle;
\node[font=\titlefont\large,white] at ($(B)!0.5!(D)$) {\small EXERCISES \thetcbcounter};
}
}

% Makes the "To think about" box.
% It is missing to set title font and font size. After that should check if the title is centralized in the title box.
\newtcolorbox{reflection}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=yellow!35!red, borderline west={3mm}{0pt}{white}, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=-1pt, outer arc = 3mm, arc = 3mm, 
fonttitle=\rmfamily\large\boxtitlefont,  % Should be 12 pt. Don't know how to set this.
title=DEFINITION, 
boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt}, 
attach boxed title to top left={xshift=3mm , yshift=-2.5mm},
underlay boxed title={
\filldraw [draw=yellow!35!red, fill=yellow!35!red] ($(title.north west) + (0 mm,-2.50mm)$) -- ++(0.00mm,1.50mm) arc [start angle=180, end angle=90, y radius=2.00mm, x radius=2.00mm] -| ++(34.00mm,-5.00mm) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| cycle;}
}


\newtcolorbox{Thm}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=session2, borderline west={3mm}{0pt}{white}, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=-1pt, outer arc = 3mm, arc = 3mm, 
fonttitle=\rmfamily\large\boxtitlefont,  % Should be 12 pt. Don't know how to set this.
title=THEOREM, 
boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt}, 
attach boxed title to top left={xshift=3mm , yshift=-2.5mm},
underlay boxed title={
\filldraw [draw=session2, fill=session2] ($(title.north west) + (0 mm,-2.50mm)$) -- ++(0.00mm,1.50mm) arc [start angle=180, end angle=90, y radius=2.00mm, x radius=2.00mm] -| ++(34.00mm,-5.00mm) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| cycle;}
}


% Observation Box
% ********************************************************
\newtcolorbox{observationtitle}[1]{
parbox=false, enhanced, breakable, left=3mm, right=3mm,bottom=2mm, colback=box2!50, colframe=box2!50, arc=3mm, sharp corners=uphill, pad at break=2mm, drop fuzzy shadow, title={\bfseries\textcolor{cor2}{#1}}, boxed title style ={empty},top=8mm, attach boxed title to top center={xshift=0mm, yshift=-7mm}
}

\newtcolorbox{observation}[1]{parbox=false, enhanced, breakable, left=3mm, right=3mm, top=4mm, bottom=2mm, colback=box2!50, colframe=box2!50, arc=3mm, sharp corners=uphill, pad at break=2mm, drop fuzzy shadow, title={\CJKfontspec{方正隶书_GBK}\textcolor{session1}{#1}}, attach boxed title to top center={xshift=0mm, yshift=-5.5mm}, boxed title style ={empty}}	 

\newtcolorbox[auto counter, number within=chapter, number freestyle={\noexpand\arabic{\tcbcounter}}]{example}[1]{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=10mm, bottom=3mm, colback=cor2!20!white, colframe=white, drop fuzzy shadow, width=162mm, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 8mm, arc = 8mm, sharp corners = northwest, sharp corners = southeast, sharp corners = southwest,
title={
%{\boxfont Example}\hspace{3.5mm} 
\textcolor{box3}{\bfseries\large\CJKfontspec{方正隶书_GBK}\makefirstuc{#1}\phantom{ç}}
}, 
boxed title style={empty, sharp corners}, 
attach boxed title to top left={xshift=22mm , yshift=-10mm},
underlay boxed title ={
% Draw the title underlay rectangle
\def\temp{#1}\ifx\temp\empty
%
\else
% 这个是子标题的框
%\fill[cor2] ($(frame.north west)+(0,0.4pt)$) rectangle ($(title.south east)+(3mm,0mm)$) coordinate (R);
\fi
%)

% Filldraw the darker fancy in front of the rectangle and behind the Example. The coordinates should be better chosen.
% ********************************************************
\fill[session1] (frame.north west) -- ($(frame.north west)+(0,-1.4pt)+(0,-7mm)$) -- ++ (22mm,0mm) arc [start angle=-90, end angle=0, x radius = 2mm, y radius = 1mm] -- ($(frame.north west) + (24mm,0)$) --  cycle;
\node [white] at ($(frame.north west) + (12mm,-3.5mm)$) {
\bfseries\boxtitlefont EXAMPLE \thetcbcounter};
},
before upper={\CJKfontspec{华文行楷}\color{black}}
}

% Research Box
% ********************************************************
\newtcolorbox{research}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=box3, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 3mm, arc = 3mm, sharp corners = northwest,
fonttitle=\normalsize\boxtitlefont,  
title= SCIENTIFIC DRAWING, 
boxed title style={empty, colback = box3, colframe = box3, sharp corners}, 
attach boxed title to top left={xshift=-2.5mm , yshift=-6.2mm},
underlay boxed title={
\filldraw [fill=box3, draw=box3] ($(frame.north west)$) rectangle +(40.00mm,-5.00mm);
\coordinate (A) at ($(frame.north west) + (36.00mm,0.00mm)$);
%\filldraw [cor1] ($(A) + (-4.7mm,0mm)$) rectangle ++(-7mm,-6.4mm);
%\fill [box3] ($(A) + (-11.9mm,-3.5mm)$) -- ++(4.8 mm,2.6 mm) arc [start angle=20, end angle=-60, x radius=1.00mm, y radius=2.35mm] --++ (0,-2mm)-- ($(title.south east) + (-1.1mm,0.20mm)$) -- ($(title.south east) + (-2mm,0.20mm)$) -- cycle; 
%\node [white] at ($(A) + (0mm,-2.5mm)$) {\includegraphics[height=5mm]{lupa}};
}
}

% Knowledge Box
% ********************************************************
\newtcolorbox{knowledge}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=session1!20, drop fuzzy shadow,colframe=white, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 3mm, arc = 3mm, sharp corners = northwest,
fonttitle=\normalsize\boxtitlefont,  
title= RESULTS, 
boxed title style={empty, colback = box3, colframe = box3, sharp corners}, 
attach boxed title to top left={xshift=-2.3mm , yshift=-5.5mm},
underlay boxed title={
\filldraw [fill=cor1a, draw=cor2a] ($(frame.north west) + (.4mm,0mm)$) rectangle ++(24.00mm,-5.00mm);% the rectangle where the title fits.
\coordinate (A) at ($(frame.north west) + (24.00mm,-2mm)$);
%\node at (A) {\includegraphics[scale=1]{interrogacao.png}};
}
}

% Evaluation Box
% ********************************************************
\NewEnviron{evaluation}{
	\begin{tikzpicture}[baseline=(Name.base),remember picture]
		\begin{pgfonlayer}{main}
			\node  (Name) {
			\begin{minipage}{0.90\textwidth}
				\BODY			
			\end{minipage}	
			};
		\end{pgfonlayer}
		\begin{pgfonlayer}{main}
			\filldraw [fill=white, draw=white] (Name.north west) arc [start angle=270, end angle=180, x radius=0.00mm, y radius=0.00mm] -- ++(0.00mm,7.00mm) arc [start angle=180, end angle=90, x radius=0.00mm, y radius=2mm] -- ++(0.00mm,0.00mm) coordinate (a) -- cycle;


			\node [draw=cor2, fill=cor2, minimum height=6.00mm, right] (heading) at ($(a) + (0.00mm,-5.00mm)$) {\color{white}\bfseries\CJKfontspec{方正隶书_GBK} RESULTS};
			\filldraw [fill=cor2, draw=cor2a] (heading.north east) -- ++(6.1mm,-6.1mm) coordinate (b) -| cycle;
		\end{pgfonlayer}
		
		\begin{pgfonlayer}{background}
			\draw [draw=yellow!30!red, line width=0.3mm, overlay] ($(Name.north west) + (27.00mm,1mm)$) -| ($(Name.south east) + (15.50mm,-1.50mm)$) -- ($(Name.south west) + (-1.50mm,-1.50mm)$);
		\end{pgfonlayer}	
	\end{tikzpicture}
}

% 练习与实战的盒子绘制
% ********************************************************
\NewEnviron{project}{
\color{session2}
    \newpage
	\begin{tikzpicture}[remember picture, overlay]
		\coordinate (border1) at ($(current page text area.south east) + (0.00mm,8.00mm)$);
		\coordinate (border1a) at ($(border1) + (-5.00mm,2.00mm)$);
		\coordinate (border1b) at ($(current page text area.south west) + (11.00mm,10.00mm)$);
		\coordinate (border1c) at ($(current page text area.north west) + (11.00mm,-13.00mm)$);
        \coordinate (border1d) at ($(current page text area.south west) + (11.00mm,13.00mm)$);
		\coordinate (heading) at ($(current page text area.north west) + (32.50mm,-5.00mm)$);
		\coordinate (corner1) at ($(current page text area.north west) + (6.00mm,-10.00mm)$);
		\coordinate (corner2) at ($(current page text area.north east) + (-4.00mm,-10.00mm)$);
		\coordinate (corner3) at ($(current page text area.south east) + (0.00mm,10.00mm)$);
		\coordinate (corner4) at ($(current page text area.south west) + (10.00mm,6.00mm)$);
		\coordinate (text1) at ($(current page text area.north west) + (11.00,-12.50mm)$);
		\coordinate (text2) at ($(current page text area.south east) + (-2.50mm,8.50mm)$);
        \coordinate (bodytextpos) at ($(border1c) + (5.00mm,-3.00mm)$);
		
		\begin{pgfonlayer}{background}
			\draw [draw=session1, fill=session1] (current page text area.south west) rectangle (current page text area.north east);
            		\end{pgfonlayer}
		
\begin{pgfonlayer}{main}
			\draw [fill=cor2, draw=cor2] (current page text area.north west) -- ++(0.00mm,-8.00mm) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] -| ++(63.00mm,8.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
			\draw [fill=base1!30, draw=base1!30] (corner1) -- (corner2) arc [start angle=90, end angle=0, x radius=4.00mm, y radius=4.00mm] -- (corner3) arc [start angle=0, end angle=-90, x radius=4.00mm, y radius=4.00mm] -- (corner4) arc [start angle=270, end angle=180, x radius=4.00mm, y radius=4.00mm] -- cycle;
			 \draw [box3,thick,dashed] (text1) rectangle (text2);
			\draw [cor2] (border1a) -- (border1b) -- (border1c) -| cycle;

\end{pgfonlayer}
		
\begin{pgfonlayer}{foreground}
			\node [color=base1!30, font=\CJKfontspec{方正隶书_GBK}\bfseries\fontsize{15pt}{0}\selectfont] (title) at (heading) {PRACTICE AND EXERCISES};
            \node [session1!30!black, below right] (bodytext) at (border1c){%
			\begin{minipage}{0.85\textwidth}
				\BODY			
\end{minipage}	
			};
\end{pgfonlayer}

\end{tikzpicture}
    \clearpage
}

% Loads the ifthen package
% ********************************************************
\RequirePackage{ifthen}

\RequirePackage{xkeyval}

\definecolor{cor1}{RGB}{0,165,157} 
\definecolor{cor2}{RGB}{73,85,93}
\definecolor{cor1a}{RGB}{0,165,157}
\definecolor{cor2a}{RGB}{73,85,93}
\definecolor{cor1b}{RGB}{251,181,0}
\definecolor{cor2b}{RGB}{73,85,93}

\definecolor{base1}{RGB}{184,202,213}
\definecolor{base2}{RGB}{221,223,80}

\definecolor{session1}{RGB}{0,94,176} 
\definecolor{session2}{RGB}{75,173,49} 
\definecolor{session3}{RGB}{183,13,40} 
\definecolor{session4}{RGB}{236,107,16} 

\definecolor{penaqua}{RGB}{0,165,157}
\definecolor{grafite}{RGB}{73,85,93}
\definecolor{penazul}{RGB}{0,94,176}
\definecolor{penverde}{RGB}{75,173,49}
\definecolor{penvinho}{RGB}{83,13,40}
\definecolor{penlaranja}{RGB}{236,107,16}
\definecolor{penbox2}{RGB}{240,238,201}

\definecolor{box1}{RGB}{71,30,129}
\definecolor{box2}{RGB}{225,221,146}
\definecolor{box3}{RGB}{108,27,98}
\definecolor{linkscolor}{RGB}{6,69,173}

\definecolor{magblue}{RGB}{151,255,249}

\definecolor{primario}{RGB}{0,165,157} 
\definecolor{secundario}{RGB}{73,85,93} 
\definecolor{terciario}{RGB}{184,202,213} 
\definecolor{destacado}{RGB}{183,13,40} 
\definecolor{atento}{RGB}{0,94,176} 

% Set up options for color schemes
% ********************************************************
\newboolean{coloroptions}

\define@choicekey*+{colorchoices}{color options}[\val\coloroption]
    {option 1, option 2}{
            \ifcase\coloroption\relax
                \definecolor{cor1}{RGB}{0,165,157}
                \definecolor{cor2}{RGB}{73,85,93}
                % \setboolean{coloroptions}{true}
            \or
                % \setboolean{coloroptions}{false}
                \definecolor{cor1}{RGB}{251,181,0}
                \definecolor{cor2}{RGB}{73,85,93}
            \fi
        }{
            % \setboolean{coloroptions}{true}
            \definecolor{cor1}{RGB}{0,165,157}
            \definecolor{cor2}{RGB}{73,85,93}
        }

% 3 - Livro Aberto Fonts
% ********************************************************
% This package sets up the fonts for the Livro Aberto textbook.
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
% The fonts used in this package:
% Title: Orbitron
% Main (Text): Exo 2
% Boxes: Roboto

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}
\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

% Loads the ifthen package
% ********************************************************
\RequirePackage{ifthen}

% Font Setup
% ********************************************************
\RequirePackage{fontspec}
\setmainfont[Path=\fontspath]{STKAITI.TTF}[BoldFont=Exo2-Medium.otf, ItalicFont=Exo2-LightItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf]
\newfontfamily{\titlefont}[Path=\fontspath]{orbitron-medium.otf}[BoldFont=orbitron-bold.otf]
\newfontfamily{\secondtitlefont}[Path=\fontspath]{orbitron-black.ttf}
\newfontfamily{\thirdtitlefont}[Path=\fontspath]{orbitron-bold.otf}
\newfontfamily{\pagetitlefont}[Path=\fontspath]{Orbitron-Regular.ttf}
\newfontfamily{\boxfont}[Path=\fontspath]{simkai.ttf}
\newfontfamily{\enumeratefont}[Path=\fontspath]{Exo2-Light.otf}[BoldFont=Exo2-Medium.otf, ItalicFont=Exo2-LightItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf]
\newfontfamily{\boxtitlefont}[Path=\fontspath]{Exo2-Bold.otf}[BoldFont=Exo2-ExtraBold.ttf, ItalicFont=Exo2-BoldItalic.ttf, BoldItalicFont=Exo2-ExtraBoldItalic.ttf] 
\newfontfamily{\extitlefont}[Path=\fontspath]{Exo2-SemiBold.otf} 
\newfontfamily{\boxexample}[Path=\fontspath]{Exo2-Regular.otf}[BoldFont=Exo2-SemiBold.ttf, ItalicFont=Exo2-RegularItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf] 

% 4-Open Book Headings
% ********************************************************
% This package creates the heading designs for the Livro Aberto textbook.
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
% ========================================================

% Loads the ifthen package
% ********************************************************
\RequirePackage{ifthen}

% Commands for chapter page
% ********************************************************
\newcommand\chapterillustration{}
\newcommand\chapterwhat{}
\newcommand\chapterbecause{}

% Formatting the commands \section and \subsection
% ********************************************************
\titleformat{\section}{\color{cor2}\normalfont\semihuge\bfseries}{\thesection}{1em}{#1 \phantomsection}
\titlespacing*{\section}
{0pt}{2mm}{1mm}

% \providecommand*{\toclevel@section}{2}
% ********************************************************
\titleformat{\subsection}{\color{cor2}\normalfont\Large\bfseries}{\thesection}{1em}{#1}
\titlespacing*{\subsection}
{0pt}{2mm}{1mm}

\titleformat{\paragraph}{\vspace{.3\baselineskip}\color{cor2}\normalfont\large\bfseries}{\thesubsection}{1em}{#1}
\titlespacing*{\paragraph}
{0pt}{1mm}{1mm}

\renewcommand*{\toclevel@section}{1}
\renewcommand*{\toclevel@subsection}{4}
\renewcommand*{\toclevel@paragraph}{5}
\renewcommand*{\toclevel@subparagraph}{6}

\providecommand*{\toclevel@exploresec}{1}
\providecommand*{\toclevel@practicesec}{1}
\providecommand*{\toclevel@arrangesec}{1}
\providecommand*{\toclevel@knowsec}{1}
\providecommand*{\toclevel@exercisesec}{1}

\titleformat{\bibliographytitle}{\vspace{.3\baselineskip}\color{cor1}\normalfont\huge\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\subsection}
{0pt}{1mm}{1mm}

% Color Exploring
% *****************************************************
\newcommand{\scexplore}[1]{\hypersetup{linkcolor=session1}\paragraph{\color{session1}\normalfont\Large\bfseries#1}\hypersetup{linkcolor=linkscolor}}
\newcommand{\scarrange}[1]{\hypersetup{linkcolor=session4}\paragraph{\color{session4}\normalfont\Large\bfseries#1}\hypersetup{linkcolor=linkscolor}}
\newcommand{\scpractice}[1]{\hypersetup{linkcolor=session2}\paragraph{\color{session2}\normalfont\Large\bfseries#1}\hypersetup{linkcolor=linkscolor}}
\newcommand{\scknow}[1]{\hypersetup{linkcolor=session2}\paragraph{\color{session3}\normalfont\Large\bfseries#1}\hypersetup{linkcolor=linkscolor}}
\newcommand{\scexercise}[1]{\hypersetup{linkcolor=cor1}\paragraph{\color{cor1}\normalfont\Large\bfseries#1}\hypersetup{linkcolor=linkscolor}}

% Paragraph
% ********************************************************
\newcommand{\subexplore}[1]{\paragraph{\color{session1}\normalfont\Large\bfseries#1}}
\newcommand{\subarrange}[1]{\paragraph{\color{session4}\normalfont\Large\bfseries#1}}
\newcommand{\subpractice}[1]{\paragraph{\color{session2}\normalfont\Large\bfseries#1}}
\newcommand{\subknow}[1]{\paragraph{\color{session3}\normalfont\Large\bfseries#1}}
\newcommand{\subexercise}[1]{\paragraph{\color{cor1}\normalfont\Large\bfseries#1}}

% Create box shape
% ********************************************************
\pgfdeclareshape{howbecausetextbox}{
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]
    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}
    \inheritanchor[from=rectangle]{north west}
    \inheritanchor[from=rectangle]{north east}
    \inheritanchor[from=rectangle]{south east}
    \inheritanchor[from=rectangle]{south west}

% ********************************************************
    \backgroundpath{
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% ********************************************************
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya+5pt}}
    \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya+5pt}}
    \pgfpatharc{0}{-90}{5.0pt}
    \pgfpathlineto{\pgfpoint{\pgf@xa+5pt}{\pgf@ya}}
    \pgfpatharc{270}{180}{5.0pt}
%        \pgfpathcurveto{\pgfpoint{\pgf@xc}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@yc}}
        \pgfpathclose
    }
}

\pgfdeclareshape{howbecauseheadingbox}{%
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]
    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}
    \inheritanchor[from=rectangle]{north west}
    \inheritanchor[from=rectangle]{north east}
    \inheritanchor[from=rectangle]{south east}
    \inheritanchor[from=rectangle]{south west}
    \backgroundpath{%
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% ********************************************************
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpatharc{90}{0}{7.0pt}
    \pgfpathlineto{\pgfpoint{\pgf@xb+7pt}{\pgf@ya+7.0pt}}
    \pgfpatharc{0}{-90}{7.0pt}
    \pgfpathclose
    }
}

\newtcolorbox{openningbox}{
  enhanced,
%  jigsaw,
  opacityframe=.3,
  opacityfill=.3,
  width=80mm,
  left=3mm,
  right=3mm,
  top=3mm,
  bottom=.5mm,
  colback=white,
  colframe=white,
  arc=3mm,
  sharp corners=uphill,
    % frame empty,
    % arc = 8pt,
   lower separated = false,
    before upper = \tcbsubtitle{序\qquad 言},
    before lower = \tcbsubtitle{内容概要},
    fontupper = \CJKfontspec{方正隶书_GBK},
    fontlower = \CJKfontspec{方正隶书_GBK},
    sharp corners = north,
    subtitle style = {
      frame empty,
      fontupper = \fontsize{13pt}{0}\selectfont\titlefont\bfseries,
      colback = shang1,
      coltext = black!70,
      width = 3.5cm,
      arc = 8pt,
      rounded corners = east
    }
  }

\newcommand{\ChapNumTitle}[1]{%
  % \thispagestyle{plain}
  \thispagestyle{empty}
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (a) at ($(current page.north west) + (44.00mm,-44.00mm)$);
        \coordinate (c) at ($(current page.north west) + (148.54mm,-64.82mm)$);
        \coordinate (d) at ($(current page.north) + (0.00mm,-78.57mm)$);

        \begin{pgfonlayer}{top}

            % \node[rotate=15] at (13.5,3.5) {\begin{tikzpicture}\fill[shang1]($(current page.south west)-(108.54mm,-300.82mm)$)[bend left=-35] to ($(current page.south)-(-78mm,-194.82mm)$)--(current page.north east)[bend left=-25]--($(current page.north west)-(108.54mm,-94.82mm)$)--cycle;
            % \end{tikzpicture}};

            % \node[rotate=20] at (13.5,3.5) {\begin{tikzpicture}\fill[shang]($(current page.south west)-(108.54mm,-300.82mm)$)[bend left=-35] to ($(current page.south)-(-78mm,-194.82mm)$)--(current page.north east)[bend left=-25]--($(current page.north west)-(108.54mm,-94.82mm)$)--cycle;
            % \end{tikzpicture}};

            % \node[rotate=20] at (10.5,8) {\begin{tikzpicture}\fill[shang1]($(current page.south west)-(108.54mm,-300.82mm)$)[bend left=-35] to ($(current page.south)-(-80mm,-275mm)$)--(current page.north east)[bend left=-25]--($(current page.north west)-(18.54mm,-94.82mm)$)--cycle;
            % \end{tikzpicture}};

            % \node[rotate=25] at (10.5,8.3) {\begin{tikzpicture}\fill[shang]($(current page.south west)-(108.54mm,-300.82mm)$)[bend left=-35] to ($(current page.south)-(-80mm,-275mm)$)--(current page.north east)[bend left=-25]--($(current page.north west)-(18.54mm,-94.82mm)$)--cycle;
            % \end{tikzpicture}};

            % \node[rotate=20] at (10.5,8.5) {\begin{tikzpicture}\fill[shang1]($(current page.south west)-(108.54mm,-300.82mm)$)[bend left=-35] to ($(current page.south)-(-80mm,-275mm)$)--(current page.north east)[bend left=-25]--($(current page.north west)-(18.54mm,-94.82mm)$)--cycle;
            % \end{tikzpicture}};

        \filldraw [fill=shang2!60!black, draw=shang2,opacity=0.8] ($(a) + (0.00mm,-25.00mm)$) -- ++(22.00mm,0.0mm) arc [start angle=270, end angle=360, x radius = 3.00mm, y
        radius=3.00mm] coordinate (c1) -- ++(0.00mm,44.00mm) coordinate (c2) arc [start angle=0, end angle=90, x radius=3.00mm, y radius=3.00mm] --
        ++(-44.00mm,0.00mm) arc [start angle=90, end angle=180, x radius=3.00mm, y radius=3.00mm] -- ++(0.00mm,-44.00mm) arc [start angle=180, end
        angle=270, x radius=3.00mm, y radius=3.00mm] -- cycle;
        \node[font=\chapnumfont, text=cor2,opacity=0.6] at (a) {\chapnamefont\thechapter};

        \coordinate (b) at ($(c1)!0.5!(c2)-(80pt,120pt)$);
        \node (title) at (b) [right, font=\CJKfontspec{方正隶书_GBK}, text=white,scale=3] {\begin{varwidth}{12cm}\baselineskip=1cm #1\end{varwidth}};
        
        \node [right] at ($(current page.north)+(-15mm,-150mm)$) %
        {\begin{openningbox}
            \chapterwhat

            \tcblower

            \chapterbecause

            \end{openningbox}};

        \end{pgfonlayer}

        \begin{pgfonlayer}{bottom}
            \node[opacity=0.8,inner sep=0pt] at (current page.center){\includegraphics[width=\paperwidth,height=\paperheight]{\chapterillustration}};
        \end{pgfonlayer}

        \begin{pgfonlayer}{top}

        \end{pgfonlayer}
    \end{tikzpicture}
}

\newcommand{\ChapNoNumTitle}[1]{
    \thispagestyle{plain}
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (a) at ($(current page.north west) + (44.00mm,-44.00mm)$);

        \filldraw [fill=cor1] ($(a) + (0.00mm,-25.00mm)$) -- ++(22.00mm,0.0mm) arc [start angle=270, end angle=360, x radius = 3.00mm, y
        radius=3.00mm] coordinate (c1) -- ++(0.00mm,44.00mm) coordinate (c2) arc [start angle=0, end angle=90, x radius=3.00mm, y radius=3.00mm] --
        ++(-44.00mm,0.00mm) arc [start angle=90, end angle=180, x radius=3.00mm, y radius=3.00mm] -- ++(0.00mm,-44.00mm) arc [start angle=180, end
        angle=270, x radius=3.00mm, y radius=3.00mm] -- cycle;
       \node[textbf, text=cor2] at (a) {\chapnamefont\thechapter};

        \coordinate (b) at ($(c1)!0.5!(c2)$);
        \node (title) at (b) [right, font=\chaptitlefont] {#1};
    \end{tikzpicture}
}
\newif\ifnumberedchap
\numberedchaptrue

% ****************************************************
% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% Even (left) page number command 偶数页（左边）设置
% *****************************************************
\newcommand{\leftpagenumber}{%
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south west) + (13.50mm,6.80mm)$);
            \begin{pgfonlayer}{main}
% 偶数页（页码边框设置）左边页码
% ------------------------------------------------------
                % Square for page number

           %\filldraw [fill=cor2, draw=cor2] (bottom) rectangle ++(-15.00mm,20.00mm) coordinate (corner);

                \filldraw [fill=cor2, draw=cor2] (bottom) rectangle ++(-10.00mm,10.00mm) coordinate (corner);
            \end{pgfonlayer}

% 偶数页（左边页码格式设置）
% ------------------------------------------------------
            \begin{pgfonlayer}{foreground}
                \node [text=white, scale=1,font=\Large\bfseries](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}
    \end{tikzpicture}
}

% Odd (right) page number command 偶数页（左边）设置
% ******************************************************
\newcommand{\rightpagenumber}{
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south east) + (-13.50mm,6.80mm)$);
            \begin{pgfonlayer}{main}

% 奇数页（页码边框设置）右边页码设置
% ------------------------------------------------------
                \filldraw [fill=session1, draw=session1] (bottom) rectangle ++(8.00mm,8.00mm) coordinate (corner);
            \end{pgfonlayer}

            \begin{pgfonlayer}{foreground}
                \node [text=white, font=\bfseries](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}

    \end{tikzpicture}
}

\newcommand{\drawpage}{
    \begin{tikzpicture}[remember picture, overlay]
        \draw [green, thick] (current page.north west) -- (current page.north east) -- (current page.south east) -- (current page.south west) -- cycle;
    \end{tikzpicture}
}


% Draw headers. This places the tabs on the side of the page
\newcommand{\leftpagetab}{
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);

% 右边竖线盒子设置
% ------------------------------------------------------
       \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,0.00mm)$) rectangle ++(8.00mm,-8.00mm) coordinate (taba) {};

 % Square for chapter number
        \coordinate (tabb) at ($(taba) + (-8.00mm,-8.00mm)$);
        \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
        \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thirdtitlefont\thechapter};
         \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,-26.00mm)$) -- ++(9.00mm,0.00mm) -- ++(0.00mm,-9.00mm) -| cycle;

% Add chapter name
% 右边竖线内填入章节名称
% ****************************************************
        \node [fill=cor2, text=white] (chaptertitle) at (tabb) [rotate=90, below left, minimum height = 8.00mm] {\tiny\titlefont \MakeUppercase{\chaptername}};

% Add end tab
% 右边竖框末尾
% ****************************************************
        \fill [fill=cor2] (chaptertitle.north west) -- ++(0.05mm,-4.00mm) coordinate (t1) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm]  -- ++(4.00mm,0.00mm) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;


% Add chapter name
% 右边竖线内填入章节名称（框外）
% ****************************************************
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=session1] {\CJKfontspec{方正隶书_GBK} \leftmark};
    \end{tikzpicture}
}

% 最大的竖直框
\newcommand{\rightpagetab}{
    \begin{tikzpicture}[remember picture, overlay]

% 左边大竖线框
% ****************************************************************
 %\filldraw [fill=session1, draw=session1] (current page.north  west) rectangle ($(current page.south west) + (18.00mm,0.00mm)$) coordinate (bottom) {};
% ****************************************************************

\coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);

        % Draw color block
\filldraw [fill=cor2, draw=cor2] ($(current page.north west) + (18.00mm,0.00mm)$) rectangle ++(-8.00mm,-8.00mm) coordinate (taba) {};

        % Square for chapter number
        \coordinate (tabb) at ($(taba) + (8.00mm,-8.00mm)$);
         \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
        \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thirdtitlefont\thechapter};

        % Add chapter name
        \node [fill=cor2, text=white] (chaptertitle) at (tabb) [rotate=90, above left, minimum height = 8.00mm] {\tiny\titlefont \MakeUppercase{\chaptername}};

        % Add end tab
        \filldraw [fill=cor2, draw=cor2] (chaptertitle.south west) -- ++(0.00mm,-4.00mm) coordinate (t1) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++(-4.00mm,0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;

        % Add chapter title
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=session1, xshift=-0.00mm] {\CJKfontspec{方正隶书_GBK}\leftmark};

        % Square for page number
        %\filldraw [fill=cor1, draw=cor1] ($(bottom) + (0.00mm, 20.00mm)$) rectangle ++(8.00mm,8.00mm);
    \end{tikzpicture}
}

\let\oldnewline\newline % redefinition: \newline is \relax
\newcommand\AnnCL{
\def\newline{\relax}} % recovering the original meaning of \newline
\newcommand\RecCL{
  \def\newline{\oldnewline}}

% *****************************************************
% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

% Section 设置
% *****************************************************
\titleclass{\exploresec}{straight}[\section]
\newcounter{exploresec}
% \counterwithin{exploresec}{chapter}
\renewcommand*{\theexploresec}{\arabic{exploresec}}


\titleformat{\exploresec}[hang]{\large\color{session1}\secondtitlefont}{\theexploresec}{0pt}{\phantomsection
\begin{tikzpicture}[remember picture, scale=1.3]
        \filldraw [fill=session1, draw=session1] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont \thesection};
        \draw [session1, thick] (b) --++ ($(\textwidth,0.00mm)+(-72 mm,0 mm)$);
        \node (title) at ($(a1)!0.5!(b1)$) [right,scale=1.5] {\CJKfontspec{方正隶书_GBK}\MakeUppercase{#1}};
\end{tikzpicture}}

\titlespacing*{\exploresec}{0pt}{8mm}{3pt}

\newcommand{\explore}[1]
{	
	\needspace{\textheight}\checkoddpage\ifoddpage\else\cleardoublepage\fi%
	\stepcounter{exploresec}
	\exploresec{\texorpdfstring{}{Explorando: }#1}
	%\color{session1}
	\setlist[enumerate]{label=\protect\bfseries\textcolor{cor2}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{cor2}{\roman*)},ref=\protect\bfseries\textcolor{cor2}{\alph*)}} 
}

% Practicing
% *****************************************************
\titleclass{\practicesec}{straight}[\section]
\newcounter{practicesec}
\renewcommand*{\thepracticesec}{\arabic{practicesec}}

\titleformat{\practicesec}[hang]{\large\color{session2}\secondtitlefont}{\thepracticesec}{0pt}{\phantomsection
\needspace{\textheight}\checkoddpage\ifoddpage\else\cleardoublepage\fi%
\begin{tikzpicture}[remember picture, scale=1.3]% overlay removed from original, otherwise the stays behind the text, scale.
        \filldraw [fill=session2, draw=session2] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont PRATICANDO};
        \draw [session2, thick] (b) --++ ($(\textwidth,0.00mm)+(-72 mm,0 mm)$); 
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\MakeUppercase{#1}};
\end{tikzpicture}}

\titlespacing*{\practicesec}{0pt}{8mm}{3pt}

\newcommand{\practice}[1]
{
	\needspace{.15\textheight}
	\stepcounter{practicesec}
	\practicesec{\texorpdfstring{}{Praticando: }#1}
	\pdfbookmark[\thepracticesec]{Praticando: #1}{}
	\color{session1}
	\setlist[enumerate]{label=\protect\bfseries\textcolor{cor2}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{cor2}{\roman*)},ref=\protect\bfseries\textcolor{cor2}{\alph*)}} 
}

% To Know +
% *****************************************************
\titleclass{\knowsec}{straight}[\chapter]
\newcounter{knowsec}
\renewcommand*{\theknowsec}{\arabic{knowsec}}

\titleformat{\knowsec}[hang]{\large\color{session3}\secondtitlefont}{\theknowsec}{0pt}{
\phantomsection
\begin{tikzpicture}[remember picture, scale=1.3] % overlay removed from original, otherwise the stays behind the text, scale.
        \filldraw [fill=session3, draw=session3] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont PARA SABER \Huge{+}};
        \draw [session3, thick] (b) --++ ($(\textwidth,0.00mm)+(-72 mm,0 mm)$); % changed
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\MakeUppercase{#1}};
\end{tikzpicture}}

\titlespacing*{\knowsec}{0pt}{8mm}{3pt}

\newcommand{\know}[1]
{
	\needspace{.15\textheight}
	\stepcounter{knowsec}
	\knowsec{\texorpdfstring{}{Para Saber +: }#1}
	 \pdfbookmark[\theknowsec]{Para Saber +: #1}{}
	\color{session3}
	\setlist[enumerate]{label=\protect\bfseries\textcolor{cor2}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{cor2}{\roman*)},ref=\protect\bfseries\textcolor{cor2}{\alph*)}} 
}

% Organizing
% *****************************************************
\titleclass{\arrangesec}{straight}[\section]
\newcounter{arrangesec}
\renewcommand*{\thearrangesec}{\arabic{arrangesec}}

\titleformat{\arrangesec}[hang]{\large\color{session4}\secondtitlefont}{\thearrangesec}{0pt}{\phantomsection
\needspace{\textheight}\checkoddpage\ifoddpage\else\cleardoublepage\fi%
\begin{tikzpicture}[remember picture, scale=1.3] % overlay removed from original, otherwise the stays behind the text, scale.
        \filldraw [fill=session4, draw=session4] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont ORGANIZANDO};
        \draw [session3, thick] (b) --++ ($(\textwidth,0.00mm)+(-72 mm,0 mm)$); % changed
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\MakeUppercase{#1}};
\end{tikzpicture}}

\titlespacing*{\arrangesec}{0pt}{8mm}{3pt}

\newcommand{\arrange}[1]
{
	\needspace{.15\textheight}
	\stepcounter{arrangesec}
	\arrangesec{\texorpdfstring{}{Organizando: }#1}
	\pdfbookmark[\thearrangesec]{Organizando: #1}{}
	\defcor2{session4}
	\setlist[enumerate]{label=\protect\bfseries\textcolor{cor2}{\alph*)}}
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{cor2}{\roman*)},ref=\protect\bfseries\textcolor{cor2}{\alph*)}} 
}

\titleclass{\exercisesec}{straight}[\chapter]
\newcounter{exercisesec}
\renewcommand*{\theexercisesec}{\arabic{exercisesec}}

\titleformat{\exercisesec}[hang]{\large\color{cor1}\secondtitlefont}{\theexercisesec}{0pt}{\phantomsection
\needspace{\textheight}\checkoddpage\ifoddpage\else\cleardoublepage\fi
\begin{tikzpicture}[remember picture]
	\draw [draw=session1, very thick] (-3.00mm,0.00mm) -- ++(0.00mm,2.00mm) -- ++(\textwidth , 0.00mm) -- ++(0mm,-2mm); 
	\fill [draw=session1, very thick , fill=session1] ($(\textwidth/2 , 0mm) + (19mm,6mm)$) -- ++(0.00mm,-5.5 mm) coordinate (line1) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| ++(-38.00mm , 0.00mm)  -- ++ (0mm, 5.5 mm) coordinate (line2) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
	\node (exercise) at ($(line1)!0.5!(line2) + (0 mm, .8 mm)$) [text=white, font=\CJKfontspec{方正隶书_GBK}\Large] {习\quad 题\thesection};%\fontsize{13pt}{0}
\end{tikzpicture}}

\titlespacing*{\exercisesec}{0pt}{8mm}{1mm}
    
\newcommand{\exercise}[1]
{	\needspace{.15\textheight}
	\stepcounter{exercisesec}
	\exercisesec{\texorpdfstring{}{Exercícios}}
	\pdfbookmark[\theexercisesec]{Exercícios}{}
	\color{black}
	\setlist[enumerate]{label=\protect\enumbox{\arabic*}}
	\setlist[enumerate,2]{label=\textit{\alph*)}
	,ref=\theenumi.\emph{\arabic*}
	}
	\setlist[enumerate,3]{label=\textit{\roman*)}
	,ref=\theenumi.\emph{\roman*}
	}
}

\newtcolorbox{stretchbox}[1][]{
  height fill,
  sharp corners,
  colback=cor2!20,
  colframe=box3,
  #1}

% Defining the section style for the diferent names that eventually appear.
% 章节文本标题设置
% *****************************************************
\setsecnumdepth{chapter} % just number the chapter, not lower levels.

% Clear page after chapter title
\renewcommand\memendofchapterhook{
    \clearpage\m@mindentafterchapter\@afterheading}

% Setup page
% 章节标题设置
% *****************************************************
\makechapterstyle{livroaberto}{
    \renewcommand{\chapnamefont}{}
    \renewcommand{\chapnumfont}{\titlefont\bfseries\fontsize{140pt}{0}\selectfont}
    \renewcommand{\chaptitlefont}{\titlefont\bfseries\fontsize{25pt}{0}\selectfont}
    \renewcommand{\chapternamenum}{}
    \renewcommand{\afterchapternum}{}
    \renewcommand{\printchaptername}{}
    \renewcommand{\printchapternum}{}
    \renewcommand{\printchapternonum}{\global\numberedchapfalse}
    \renewcommand{\printchaptertitle}[1]{%
    \thispagestyle{plain}
        \ifnumberedchap
            \ChapNumTitle{##1}
        \else
            \ChapNoNumTitle{##1}
        \fi
        \global\numberedchaptrue
        }
    \renewcommand{\afterchaptertitle}{\clearpage}
}
\renewcommand{\chaptermarksn}[1]{}

\makepagestyle{plain}
\makeevenfoot{plain}{}{\leftpagenumber}{}
\makeoddfoot{plain}{}{\rightpagenumber}{}
\makepagestyle{livroaberto}
\makeevenfoot{livroaberto}{}{\leftpagenumber}{}
\makeoddfoot{livroaberto}{}{\rightpagenumber}{}
\makeevenhead{livroaberto}{}{\rightpagetab}{}
\makeoddhead{livroaberto}{}{\leftpagetab}{}
\chapterstyle{livroaberto}
\pagestyle{livroaberto}

% 5-Open Book Lists
%*******************************************************
% This package creates the heading designs for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
% *****************************************************

\RequirePackage{tikzpagenodes}
\RequirePackage[inline]{enumitem}

\pgfdeclareshape{enumbox}{
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]
    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}

\backgroundpath{
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% *****************************************************
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya+2pt}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb-2pt}{\pgf@yb}}
        \pgfpatharc{90}{0}{2.0pt}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa+2pt}{\pgf@ya}}
        \pgfpatharc{270}{180}{2.0pt}
%        \pgfpathcurveto{\pgfpoint{\pgf@xc}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@yc}}
        \pgfpathclose
    }
}

\pgfdeclareshape{itembox}{
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]

    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}

    \backgroundpath{
        \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% *****************************************************
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
        \pgfpathclose
    }
}

\newcommand*{\enumbox}[1]{
    \tikz [baseline=(numbereditem.base)]{
        \node[shape=enumbox,text=white, font=\bfseries\fontsize{11pt}{0}\selectfont, draw=black, 
        fill=cor1, 
        minimum width=6.00mm, minimum height=6.00mm] (numbereditem) {#1};
    }
}

\newcommand*{\enumdefault}[1]{
    \tikz [baseline=(numbereditem.base)]{
        \node[shape=enumbox, font=\bfseries\fontsize{11pt}{0}\selectfont, draw=black, minimum width=6.00mm, minimum height=6.00mm] (numbereditem) {#1};
    }
}


% Defining an alternative shape for itemize, where the bullets are actually squares.
% *****************************************************
\newcommand*{\itembox}{
    \tikz [baseline=(boxitem.base)] {
        \node[shape=rectangle, draw=black, minimum width=6.00mm, minimum height=6.00mm] (boxitem) {};
    }
}

% Defining an alternative shape for itemize, where the bullets are actually colored squares.
% *****************************************************
\newcommand*{\itemcoloredsquare}{
    \tikz  {
        \node[shape=rectangle, fill=cor2, minimum width=1.50mm, minimum height=1.50mm] (boxitem) {};
    }
}


% Set up lists
% *****************************************************
\setlist[enumerate]{label=\protect\enumbox{\alph*)}}
%\setlist[itemize]{label=\protect\itembox}
\setlist[itemize]{label=\protect\itemcoloredsquare}

% 6-Open Book Page
%******************************************************
% This package sets up the page dimensions used in the Livro Aberto textbook.
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
% *****************************************************

\RequirePackage{booktabs}
\RequirePackage{url}
\RequirePackage{graphicx}
%\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{forloop}
\RequirePackage{lipsum}
\RequirePackage{microtype}
\RequirePackage{suffix}
\RequirePackage{etoolbox}
\RequirePackage{refcount}
% \RequirePackage[hidelinks]{hypreref}
\RequirePackage{xcolor}
\RequirePackage{multicol}
\RequirePackage{etex}

\RequirePackage{blindtext}

\RequirePackage{cleveref}
\PassOptionsToPackage{noabbrev}{cleveref}

\numberwithin{figure}{chapter}
%% Set Page Size
% \setstocksize{11.00in}{8.50in}

\setstocksize{275mm}{204mm}
\settrimmedsize{275mm}{204mm}{*}
% \setstocksize{275mm}{204mm}
% \settrimmedsize{\stockheight}{\stockwidth}{*}
% \settrims{2.20mm}{5.95mm}

\settypeblocksize{241mm}{162mm}{*}
\setlrmarginsandblock{20mm}{22mm}{*}
\setulmarginsandblock{17mm}{17.00mm}{*}

% \setlrmargins{*}{1.25in}{*}
% \setulmargins{*}{*}{0.85}
% \setlrmarginsandblock{1.00in}{1.00in}{*}
\setcolsepandrule{8.00mm}{0mm}

% Set Paragraphs to no indent with a 6pt space between paragraphs
% *****************************************************
\setlength{\parindent}{0em}
 \setlength{\parskip}{6pt}
%% Modify Header and Footer spacing
% \setheadfoot{\onelineskip}{2\onelineskip}

\checkandfixthelayout

% TikZ and Asymptote libraries and packages
% *****************************************************
\RequirePackage{tikz}
\usetikzlibrary{
    calc,trees,shadows,shadows.blur,positioning,arrows,chains,shapes.geometric, decorations, decorations.pathreplacing,decorations.pathmorphing,shapes,
    matrix,fit,tikzmark,intersections,through,backgrounds,arrows.meta,datavisualization}

\tikzstyle{vetor}=[->,line width=0.8pt,color=primario,>=latex]
\tikzstyle{ponto}=[circle, minimum size=2pt, inner sep=0, draw=black, fill=black, shift only, label={}]
\tikzstyle{every node}=[shift only]
\tikzstyle{eixos}=[->]
\tikzstyle{curvafun}=[very thick, color=primario]
\tikzstyle{grafica}+=[line cap=round,line join=round,color=terciario, very thick]
\newcommand{\vetoresmapaantartida}{
      \filldraw [white, fill opacity=100] (-4,-3) rectangle (4,3);
      \node at (-4,-3) {\includegraphics[width=1cm]{/home/cheque/Dropbox/Tikz-LivroAberto/Vetores/rosa.png}};
      \node [above, scale=0.5] at (-4,-2.5) {N};
      \node [left, scale=0.5] at (-4.5,-3) {E};
      \node [right, scale=0.5] at (-3.5,-3) {L};
      \node [below, scale=0.5] at (-4,-3.5) {S};
      \node [ponto] (A) at (0,0) {};
      \node [below] at (A) {$A$};
      \draw [|-|] (2,-3.5) -- (4,-3.5);
      \node [above, scale=0.5] at (3,-3.5) {10 km};
}

\RequirePackage{tikzpagenodes}

\RequirePackage{environ}

% Define asymptote picture preamble
% *****************************************************
\begin{asydef}
import three;
import graph3;
import solids;
import math;
import labelpath3;
import labelpath;
settings.render=16;
//attach=true;

pen azul = rgb(0,94/255,176/255); //azul
pen verde = rgb(75/255,173/255,49/255); //verde
pen vinho = rgb(183/255,13/255,40/255); //vinho
pen laranja = rgb(236/255,107/255,16/255); //laranja
pen agua = rgb(0,165/255,157/255); //verde agua
pen box2 = rgb(240/255,238/255,201/255);

texpreamble("\usepackage{fontspec}\setmainfont{Exo2-Light}");
\end{asydef}

% Define asymptote picture directory
% *****************************************************
\def\asydir{asytmp-perspectiva2}

% Define the layers to be used in document.
% *****************************************************
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfdeclarelayer{top}
\pgfdeclarelayer{bottom}
\pgfsetlayers{bottom,background,main,foreground,top}

% 7-Professor Open Book
%******************************************************
%This section configures the aluno document to be able to compile the professor document
%%%%%%%%%%%%%%% ENDNOTES
% Exclusão de ambientes do professor

% Text Pages
% *****************************************************
\excludecomment{paginatexto}
\excludecomment{apresentacao}

% General Objectives Box
% *****************************************************
\newtcolorbox{habilities}[1]{}

% Caixa for Specific Objectives
% *****************************************************
\newenvironment{objectives}[4]
{}
{}
{}

% Suggestions and Recommendations Box
% *****************************************************
\newenvironment{sugestions}[4]
{}
{}
{}

% Answer Box
% *****************************************************
\newenvironment{answer}[3]
{}
{}

% Text box
% *****************************************************
\newenvironment{texto}[1]
{}

\newcommand{\notarodape}[1]{\footnotemark\footnotetext{\belowbaseline[-\ht\strutbox]{\begin{tcolorbox}[colback=grafite!90!white,colbacktitle=grafite!90!white,
colframe=grafite!90!white,colupper=white, left=0pt, right=0pt,top=-2pt,bottom=-2pt, hbox, sharp corners = northeast, sharp corners = southwest]
{\textbf{#1}}\end{tcolorbox}}}}
% *****************************************************

\newenvironment{enum}{\begin{enumerate}[label=\textbf{\arabic*.},ref=\arabic*,left=0cm]}
    {
    \end{enumerate}}

\newenvironment{eenum}{\begin{enumerate}[label=(\arabic*),left=0.85cm]}
    {
    \end{enumerate}}
    \newenvironment{enuma}{\begin{enumerate}[label=(\arabic*),leftmargin=0.71cm]}
    {
    \end{enumerate}}
    \newcommand\quan[1]{
    \tikz[baseline=(a.base)]\node(a)[inner sep=0.5pt,draw,circle]{$#1$};
    }
    \newcommand\closure[1]{%
    {}\mkern2mu\overline{\mkern-2mu#1}
    }
    \renewcommand\bar{\closure}


\newcounter{definition}
\counterwithin{definition}{section}
\newcommand{\defname}{定义}
\newenvironment{definition}{
  \refstepcounter{definition}
  \textbf{\CJKfontspec{楷体}\color{session1}\defname\thedefinition} \quad
}{\par}


\newcommand{\theoremname}{定理}
\newenvironment{theorem}[1][]{\par
  \refstepcounter{definition}
  \textbf{\theoremname\thedefinition}#1\quad
}{\par}

\newcommand{\propname}{命题}
\newenvironment{prop}{\par
  \refstepcounter{definition}
  \textbf{\CJKfontspec{方正楷体简体}\color{session1}\propname\thedefinition}\quad
}{\par}

%\newcounter{example}
%\counterwithin{example}{section}

\newcommand{\lemmaname}{引理}
\newenvironment{lemma}[1][]{\par%
  \refstepcounter{definition}%
  \textbf{\CJKfontspec{方正楷体简体}\color{session1}\lemmaname\thedefinition}#1\quad
}{\par}

\newcommand{\corname}{推论}
\newenvironment{corollary}{\par%
  \refstepcounter{definition}%
  \textbf{\CJKfontspec{方正楷体简体}\color{session1}\corname\thedefinition}\quad
}{\par}

\newenvironment{solution}{\indent \CJKfontspec{方正楷体简体}\color{session1}\textbf{解}}


\newenvironment{xiti}{\par%
\centerline{\textbf{\CJKfontspec{方正楷体简体}\color{session1}习\quad 题\quad \thesection}}
\begin{enum}
}{\end{enum}}


\renewenvironment{xiti}{\par%
\centerline{\textbf{\CJKfontspec{方正楷体简体}\color{session1}习\quad 题\quad \thesection}}
\begin{enum}
}{\end{enum}}


\newcommand\pp[2]{\frac{\partial #1}{\partial #2}}
\newcommand\ppp[2]{\frac{\partial^2 #1}{\partial #2^2}}
\newcommand\pppp[3]{\frac{\partial^2 #1}{\partial #2\partial #3}}
\newcommand\dd[2]{\frac{\mathop{}\!\mathrm d#1}{\mathop{}\!\mathrm d#2}}
\newcommand\ddd[2]{\frac{\mathop{}\!\mathrm d^2#1}{\mathop{}\!\mathrm d#2^2}}
\newcommand\dx{\mathop{}\!\mathrm dx}
\newcommand\dy{\mathop{}\!\mathrm dy}
\newcommand\dz{\mathop{}\!\mathrm dz}
\newcommand\dzz{\mathop{}\!\mathrm d\bar z}
\usepackage[subrefformat=parens]{subcaption}
\DeclareMathOperator{\Arg}{Arg}
\usepackage{tkz-euclide}

\catcode`\;=\active
\newcommand{;}{\text{；}}
\numberwithin{equation}{section}
\DeclareMathOperator\diam{diam}
\DeclareMathOperator{\Log}{Log}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator*{\Res}{Res}
\newcommand\DD{D}



\endinput 